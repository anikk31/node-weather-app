name: full app test and upload

on: [push,workflow_dispatch]

jobs:
  test-job:
    runs-on: ubuntu-latest
    steps:
       - name: checkout the code
         uses: actions/checkout@v3
       - name: download node.js
         uses: actions/setup-node@v3
         with:
           node-version: 18
       - name: download dependacy
         run: npm install    
       - name: test
         run: npm test      
  deploy-job:
    runs-on: ubuntu-latest
    steps:
       - name: checkout the code
         uses: actions/checkout@v3
       - name: download node.js
         uses: actions/setup-node@v3
         with:
           node-version: 18
       - name: install dependancy
         run: npm install
       - name: deploy
         run: npm run build        
  version-test:
    runs-on: ${{ matrix.os }}
    strategy:
     matrix: 
       os: [windows-latest,ubuntu-latest]
       node_version: [14,15]
    steps:
       - name: checkout the code
         uses: actions/checkout@v3
       - name: download nodejs
         uses: actions/setup-node@v3
         with:
           node-version: ${{ matrix.node_version}}
       - name: version test final
         run: node -v    
  upload-docker:
    runs-on: ubuntu-latest
    steps:
       - name: checkout the code
         uses: actions/checkout@v3
       - name: download nodejs
         uses: actions/checkout@v3
         with:
           node-version: 18
       - name: login into docker
         uses: docker/login-action@v3
         with:
           username: ${{ secrets.DOCKER_USERNAME }}
           password: ${{ secrets.DOCKER_PASSWORD }}
       - name: setup buildx
         uses: docker/setup-buildx-action@v3    
       - name: build and push
         uses: docker/build-push-action@v3
         with:
           context: .
           push: true
           tags: ${{ secrets.DOCKER_USERNAME }}/repo:latest  